# API æ“´å……æ€§æ¸¬è©¦æ–‡ä»¶

## âœ… ç¬¦åˆæ¯”è³½è¦æ±‚ç¢ºèª

æœ¬å°ˆæ¡ˆæä¾›å®Œæ•´çš„ REST APIï¼Œç¬¦åˆæ¯”è³½è¦ç¯„ã€‚

---

## ğŸ“‹ API è¦æ ¼

### POST /chat

**å®Œæ•´ç¬¦åˆæ¯”è³½è¦æ±‚çš„æ ¼å¼**

#### è«‹æ±‚æ ¼å¼

```json
{
  "user_id": "string",
  "pet_profile": {
    "species": "dog | cat",
    "age": "number",
    "weight": "number"
  },
  "message": "string"
}
```

#### å›æ‡‰æ ¼å¼

```json
{
  "answer": "string",
  "citations": ["string"],
  "risk_level": "low | medium | high",
  "suggested_next_actions": ["string"]
}
```

---

## ğŸš€ å•Ÿå‹• API Server

### æ–¹æ³• 1ï¼šå–®ç¨å•Ÿå‹• API

```bash
npm install
npm run api
```

### æ–¹æ³• 2ï¼šåŒæ™‚å•Ÿå‹•å‰ç«¯å’Œ API

```bash
npm install
npm run start:all
```

API å°‡åœ¨ `http://localhost:3001` å•Ÿå‹•

---

## ğŸ§ª æ¸¬è©¦ç¯„ä¾‹

### æ¸¬è©¦ 1ï¼šåŸºæœ¬å•é¡Œ

```bash
curl -X POST http://localhost:3001/chat \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test_user_001",
    "pet_profile": {
      "species": "dog",
      "age": "2",
      "weight": "5"
    },
    "message": "ç‹—ç‹—å¯ä»¥åƒè‘¡è„å—ï¼Ÿ"
  }'
```

**é æœŸå›æ‡‰ï¼š**

```json
{
  "answer": "é‡å°æ‚¨çš„ç‹—ç‹—ï¼ˆ2æ­²ï¼‰ï¼ˆ5kgï¼‰ï¼š\n\nçµ•å°ä¸å¯ä»¥ï¼è‘¡è„å’Œè‘¡è„ä¹¾å°ç‹—ç‹—æœ‰åŠ‡æ¯’...",
  "citations": ["ç¸é†«é£²é£ŸæŒ‡å—"],
  "risk_level": "high",
  "suggested_next_actions": [
    "ç«‹å³è¯ç¹«ç¸é†«",
    "æœå°‹é™„è¿‘24å°æ™‚å‹•ç‰©é†«é™¢",
    "è¨˜éŒ„ç—‡ç‹€æ™‚é–“"
  ]
}
```

### æ¸¬è©¦ 2ï¼šå¥åº·æª¢æŸ¥

```bash
curl http://localhost:3001/health
```

**é æœŸå›æ‡‰ï¼š**

```json
{
  "status": "healthy",
  "version": "2.0.0",
  "timestamp": "2026-01-14T..."
}
```

### æ¸¬è©¦ 3ï¼šçŸ¥è­˜åº«è³‡è¨Š

```bash
curl http://localhost:3001/knowledge
```

**é æœŸå›æ‡‰ï¼š**

```json
{
  "version": "2.0.0",
  "last_update": "2026-01-14",
  "categories": ["é£²é£Ÿ", "å¥åº·", "ç…§è­·"],
  "entry_count": 50
}
```

---

## ğŸ“Š API åŠŸèƒ½æ¸¬è©¦æ¸…å–®

- [x] **POST /chat** - ä¸»è¦èŠå¤©æ¥å£

  - [x] æ¥å— user_id, pet_profile, message
  - [x] å›å‚³ answer, citations, risk_level, suggested_next_actions
  - [x] æ”¯æ´å€‹æ€§åŒ–å›æ‡‰ï¼ˆæ ¹æ“šå¯µç‰©è³‡æ–™ï¼‰
  - [x] æ”¯æ´é¢¨éšªç­‰ç´šåˆ¤æ–·

- [x] **GET /health** - å¥åº·æª¢æŸ¥

  - [x] å›å‚³æœå‹™ç‹€æ…‹
  - [x] å›å‚³ç‰ˆæœ¬è³‡è¨Š

- [x] **GET /knowledge** - çŸ¥è­˜åº«è³‡è¨Š
  - [x] å›å‚³çŸ¥è­˜åº«ç‰ˆæœ¬
  - [x] å›å‚³çŸ¥è­˜æ¢ç›®æ•¸é‡

---

## ğŸ”§ éŒ¯èª¤è™•ç†

### ç¼ºå°‘å¿…å¡«æ¬„ä½

```bash
curl -X POST http://localhost:3001/chat \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test"
  }'
```

**å›æ‡‰ï¼š**

```json
{
  "error": "message ç‚ºå¿…å¡«æ¬„ä½"
}
```

---

## ğŸ¯ æ“´å……æ€§å±•ç¤º

### 1. æ˜“æ–¼æ–°å¢ç«¯é»

API æ¶æ§‹æ¸…æ™°ï¼Œå¯è¼•é¬†æ–°å¢åŠŸèƒ½ï¼š

- `POST /feedback` - ç”¨æˆ¶åé¥‹
- `GET /history/:user_id` - å°è©±æ­·å²
- `POST /emergency` - ç·Šæ€¥æ±‚åŠ©

### 2. æ”¯æ´å¤šç¨®å¯µç‰©

ç›®å‰æ”¯æ´ dog/catï¼Œå¯è¼•é¬†æ“´å……è‡³ï¼š

- rabbitï¼ˆå…”å­ï¼‰
- birdï¼ˆé³¥é¡ï¼‰
- hamsterï¼ˆå€‰é¼ ï¼‰

### 3. æ•´åˆå…¶ä»– AI æœå‹™

æ¶æ§‹æ”¯æ´æ•´åˆï¼š

- Gemini APIï¼ˆå·²å¯¦ä½œï¼‰
- Claude API
- è‡ªå®šç¾©æ¨¡å‹

---

## ğŸ“ æŠ€è¡“å¯¦ä½œèªªæ˜

### æ¶æ§‹ç‰¹é»

1. **RESTful è¨­è¨ˆ** - ç¬¦åˆæ¨™æº– REST API åŸå‰‡
2. **CORS æ”¯æ´** - å…è¨±è·¨åŸŸè«‹æ±‚
3. **éŒ¯èª¤è™•ç†** - å®Œæ•´çš„éŒ¯èª¤æ•ç²å’Œå›æ‡‰
4. **çŸ¥è­˜åº«æ•´åˆ** - å‹•æ…‹è¼‰å…¥ JSON çŸ¥è­˜åº«
5. **æ—¥èªŒè¨˜éŒ„** - è«‹æ±‚è¨˜éŒ„ä¾¿æ–¼é™¤éŒ¯

### éƒ¨ç½²å»ºè­°

- ç”Ÿç”¢ç’°å¢ƒå»ºè­°ä½¿ç”¨ PM2 æˆ– Docker
- å¯éƒ¨ç½²è‡³ Vercel, Railway, Render ç­‰å¹³å°
- æ”¯æ´ç’°å¢ƒè®Šæ•¸é…ç½®ï¼ˆPORT, API_KEY ç­‰ï¼‰

---

## âœ… æ¯”è³½è¦æ±‚å°ç…§

| è¦æ±‚é …ç›®               | å¯¦ä½œç‹€æ…‹ | èªªæ˜                      |
| ---------------------- | -------- | ------------------------- |
| POST /chat ç«¯é»        | âœ… å®Œæˆ  | å®Œå…¨ç¬¦åˆæ ¼å¼è¦æ±‚          |
| user_id æ¬„ä½           | âœ… æ”¯æ´  | å¯é¸æ¬„ä½ï¼Œç”¨æ–¼è¿½è¹¤ç”¨æˆ¶    |
| pet_profile æ¬„ä½       | âœ… æ”¯æ´  | åŒ…å« species, age, weight |
| message æ¬„ä½           | âœ… æ”¯æ´  | å¿…å¡«ï¼Œç”¨æˆ¶å•é¡Œå…§å®¹        |
| answer å›æ‡‰            | âœ… æ”¯æ´  | æ™ºèƒ½å›ç­”å…§å®¹              |
| citations å›æ‡‰         | âœ… æ”¯æ´  | çŸ¥è­˜ä¾†æºå¼•ç”¨              |
| risk_level å›æ‡‰        | âœ… æ”¯æ´  | low/medium/high ä¸‰ç´š      |
| suggested_next_actions | âœ… æ”¯æ´  | å»ºè­°å¾ŒçºŒè¡Œå‹•              |

---

## ğŸ‰ ç¸½çµ

âœ… **å®Œå…¨ç¬¦åˆæ¯”è³½ API è¦æ ¼è¦æ±‚**
âœ… **æä¾›å®Œæ•´çš„æ¸¬è©¦æ–‡æª”**
âœ… **å…·å‚™è‰¯å¥½çš„æ“´å……æ€§**
âœ… **æ”¯æ´éŒ¯èª¤è™•ç†å’Œæ—¥èªŒ**
âœ… **å¯ç›´æ¥æ¼”ç¤ºçµ¦è©•å¯©æ¸¬è©¦**
