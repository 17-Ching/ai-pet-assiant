# 🧪 系統測試清單

## 測試前準備

### 1. 環境設定

```bash
# 確認 Node.js 版本
node -v  # 應該 >= 18.x

# 確認依賴已安裝
npm install

# 建立 .env 檔案
cp .env.example .env

# 編輯 .env（可選，使用預設值也可測試）
# VITE_ADMIN_PASSWORD=admin123
# GEMINI_API_KEY=your_key_here  (PDF 測試需要)
```

### 2. 啟動服務

#### 選項 A：同時啟動前後端

```bash
npm run start:all
```

#### 選項 B：分別啟動

```bash
# 終端機 1：前端
npm run dev

# 終端機 2：後端（PDF 功能需要）
npm run api
```

---

## 📋 功能測試清單

### ✅ 測試 1：基本訪問

- [ ] 1.1 開啟 http://localhost:5173（或顯示的端口）
- [ ] 1.2 主聊天介面正常顯示
- [ ] 1.3 右下角顯示版本資訊和按鈕

**預期結果**：

```
[版本 1.2.0] [2026-01-18] [🔄] [⚙️]
```

---

### ✅ 測試 2：管理後台登入

- [ ] 2.1 點擊右下角 ⚙️ 設定按鈕
- [ ] 2.2 密碼對話框彈出
- [ ] 2.3 輸入錯誤密碼（例如：wrong）
- [ ] 2.4 顯示「密碼錯誤」警告
- [ ] 2.5 輸入正確密碼：`admin123`
- [ ] 2.6 成功進入管理後台

**預期結果**：

- 顯示管理後台介面
- 左側：檔案上傳區
- 右側：知識條目編輯表格
- 頂部：「知識庫管理後台」標題

---

### ✅ 測試 3：載入現有知識庫

- [ ] 3.1 管理後台自動載入現有知識
- [ ] 3.2 右側表格顯示知識條目
- [ ] 3.3 顯示條目數量（例如：15 筆）
- [ ] 3.4 顯示當前版本（例如：版本 1.2.0）

**預期結果**：

```
✅ 已載入 15 筆知識條目
```

---

### ✅ 測試 4：下載 Excel 範本

- [ ] 4.1 點擊左側「📥 下載 Excel 範本」按鈕
- [ ] 4.2 瀏覽器下載 `寵物知識庫範本.xlsx`
- [ ] 4.3 用 Excel 開啟檔案
- [ ] 4.4 確認有兩筆範例資料
- [ ] 4.5 確認欄位：類別、標題、關鍵字、內容、來源、物種、風險等級

**預期結果**：

- 下載成功
- Excel 檔案可正常開啟
- 包含範例資料和正確欄位

---

### ✅ 測試 5：Excel 匯入（拖放）

**準備**：使用下載的範本，在 Excel 中新增一筆資料：

```
類別：餵養
標題：成犬飲水量
關鍵字：成犬,飲水,水量,每日
內容：成犬每日建議飲水量為體重（公斤）× 50-100 毫升。
來源：寵物營養學手冊
物種：dog
風險等級：low
```

**測試步驟**：

- [ ] 5.1 儲存 Excel 檔案
- [ ] 5.2 拖放檔案到上傳區虛線框
- [ ] 5.3 等待處理（1-2 秒）
- [ ] 5.4 顯示成功訊息
- [ ] 5.5 表格中出現新增的條目
- [ ] 5.6 確認欄位內容正確

**預期結果**：

```
✅ 成功匯入 3 筆知識條目
```

---

### ✅ 測試 6：Excel 匯入（點擊選擇）

- [ ] 6.1 點擊「📎 選擇檔案」按鈕
- [ ] 6.2 在檔案選擇器中選擇 Excel 檔案
- [ ] 6.3 點擊「開啟」
- [ ] 6.4 系統自動處理並顯示結果
- [ ] 6.5 表格中新增匯入的條目

**預期結果**：

- 與拖放方式結果相同
- 成功匯入並顯示

---

### ✅ 測試 7：CSV 匯入

**準備**：建立 CSV 檔案 `test.csv`

```csv
類別,標題,關鍵字,內容,來源,物種,風險等級
餵養,幼貓餵食,幼貓,餵食,營養,幼貓每日需要高蛋白質食物,貓咪營養指南,cat,low
```

**測試步驟**：

- [ ] 7.1 上傳 CSV 檔案
- [ ] 7.2 確認成功匯入
- [ ] 7.3 表格顯示新條目

**預期結果**：

```
✅ 成功匯入 1 筆知識條目
```

---

### ✅ 測試 8：PDF 匯入（需後端 API）

**前提**：

- 後端服務已啟動（`npm run api`）
- 已設定 `GEMINI_API_KEY`

**準備**：一份簡單的 PDF 檔案，內容包含寵物照護知識

**測試步驟**：

- [ ] 8.1 上傳 PDF 檔案
- [ ] 8.2 顯示「正在處理 xxx.pdf...」
- [ ] 8.3 等待 10-30 秒
- [ ] 8.4 顯示成功訊息
- [ ] 8.5 表格中出現 AI 提取的知識條目
- [ ] 8.6 檢查內容是否合理

**預期結果**：

```
✅ 成功從 PDF 提取 X 筆知識條目
```

**失敗時**：

```
❌ PDF 處理失敗: xxx（請確保後端服務已啟動）
```

---

### ✅ 測試 9：手動新增條目

- [ ] 9.1 點擊左側「➕ 手動新增條目」
- [ ] 9.2 表格最下方出現空白行
- [ ] 9.3 填寫各欄位：
  - 類別：選擇「日常照護」
  - 標題：輸入「每日梳毛」
  - 關鍵字：輸入「梳毛,護理,毛髮」
  - 內容：輸入「每日梳毛可預防毛球...」
  - 來源：輸入「寵物照護手冊」
  - 物種：勾選 🐕 和 🐈
  - 風險等級：選擇「低」
- [ ] 9.4 確認資料正確顯示

**預期結果**：

- 新行成功新增
- 所有欄位可正常編輯

---

### ✅ 測試 10：編輯現有條目

- [ ] 10.1 選擇表格中任一行
- [ ] 10.2 點擊「標題」欄位
- [ ] 10.3 修改文字
- [ ] 10.4 點擊其他欄位
- [ ] 10.5 確認修改已保存

**預期結果**：

- 欄位可正常編輯
- 修改即時生效

---

### ✅ 測試 11：刪除條目

- [ ] 11.1 點擊表格最右側的 🗑️ 按鈕
- [ ] 11.2 確認對話框彈出
- [ ] 11.3 點擊「取消」→ 條目保留
- [ ] 11.4 再次點擊 🗑️
- [ ] 11.5 點擊「確定」→ 條目刪除
- [ ] 11.6 確認條目從表格中消失

**預期結果**：

- 確認對話框正常顯示
- 刪除操作成功

---

### ✅ 測試 12：清空全部（謹慎測試）

⚠️ **警告**：此操作會清空所有條目！測試前建議先備份

- [ ] 12.1 點擊左側「🗑️ 清空全部」
- [ ] 12.2 確認對話框彈出
- [ ] 12.3 點擊「取消」→ 條目保留
- [ ] 12.4 再次點擊
- [ ] 12.5 點擊「確定」→ 所有條目清空
- [ ] 12.6 表格顯示空狀態訊息

**預期結果**：

```
🗑️ 尚無知識條目，請上傳檔案或手動新增
```

**恢復方法**：

- 重新整理頁面（F5）→ 恢復到儲存前狀態
- 或重新匯入知識

---

### ✅ 測試 13：儲存知識庫（無後端）

如果沒有啟動後端 API：

- [ ] 13.1 點擊右上角「💾 儲存知識庫」
- [ ] 13.2 填寫版本號：`1.3.0`
- [ ] 13.3 填寫更新說明：`測試儲存功能`
- [ ] 13.4 點擊「確認儲存」
- [ ] 13.5 顯示錯誤訊息

**預期結果**：

```
❌ 儲存失敗: Failed to fetch

請確保後端服務已啟動（npm run api）
```

---

### ✅ 測試 14：儲存知識庫（有後端）

**前提**：後端服務已啟動

- [ ] 14.1 確認表格中有知識條目
- [ ] 14.2 點擊右上角「💾 儲存知識庫」
- [ ] 14.3 版本號自動建議（例如：1.3.0）
- [ ] 14.4 修改或保持版本號
- [ ] 14.5 填寫更新說明：
  ```
  - 測試 Excel 匯入功能
  - 新增梳毛照護知識
  - 更新飲水量資訊
  ```
- [ ] 14.6 點擊「確認儲存」
- [ ] 14.7 等待處理（1-2 秒）
- [ ] 14.8 顯示成功對話框

**預期結果**：

```
✅ 知識庫儲存成功！

版本：1.3.0
備份檔：knowledge_backup_2026-01-20_14-30-00.json
```

---

### ✅ 測試 15：驗證儲存結果

- [ ] 15.1 點擊對話框「確定」
- [ ] 15.2 點擊右上角「✕ 返回」
- [ ] 15.3 回到主聊天介面
- [ ] 15.4 確認右下角版本號已更新
- [ ] 15.5 點擊版本號查看更新記錄
- [ ] 15.6 確認有新的更新記錄

**預期結果**：

```
版本 1.3.0  2026-01-20
```

更新記錄中包含：

- 版本：v1.3.0
- 日期：2026-01-20
- 變更：測試 Excel 匯入功能...

---

### ✅ 測試 16：知識庫重新載入

- [ ] 16.1 點擊右下角 🔄 重新載入按鈕
- [ ] 16.2 顯示「知識庫已重新載入！」警告框
- [ ] 16.3 點擊「確定」
- [ ] 16.4 測試詢問新增的知識

**測試問題**：「成犬每日飲水量建議是多少？」

**預期結果**：

- AI 能正確回答新增的知識
- 引用來源包含「寵物營養學手冊」

---

### ✅ 測試 17：備份檔案驗證

- [ ] 17.1 打開專案資料夾
- [ ] 17.2 進入 `public/` 目錄
- [ ] 17.3 確認存在多個備份檔案
- [ ] 17.4 檔名格式：`knowledge_backup_YYYY-MM-DD_HH-MM-SS.json`
- [ ] 17.5 用文字編輯器開啟備份檔
- [ ] 17.6 確認為有效的 JSON 格式

**預期結果**：

```
public/
├── knowledge.json (最新版本)
├── knowledge_backup_2026-01-20_14-30-00.json
├── knowledge_backup_2026-01-20_10-15-30.json
└── ...
```

---

### ✅ 測試 18：manifest.json 更新

- [ ] 18.1 用文字編輯器開啟 `public/manifest.json`
- [ ] 18.2 確認 `version` 欄位已更新
- [ ] 18.3 確認 `last_update` 欄位正確
- [ ] 18.4 確認 `update_records` 陣列有新記錄
- [ ] 18.5 確認最新記錄在陣列開頭

**預期內容**：

```json
{
  "version": "1.3.0",
  "last_update": "2026-01-20",
  "update_records": [
    {
      "version": "1.3.0",
      "date": "2026-01-20",
      "changes": [
        "測試 Excel 匯入功能",
        "新增梳毛照護知識"
      ]
    },
    ...
  ]
}
```

---

### ✅ 測試 19：錯誤處理

#### 19.1 上傳錯誤格式

- [ ] 上傳 .txt 檔案
- [ ] 確認顯示錯誤訊息

**預期結果**：

```
❌ 檔案處理失敗: 不支援的檔案格式
```

#### 19.2 必填欄位缺失

- [ ] 新增條目但不填寫「標題」
- [ ] 點擊「儲存知識庫」
- [ ] 確認顯示警告

**預期結果**：

```
❌ 部分條目缺少必填欄位（標題、內容、類別），請檢查！
```

#### 19.3 關鍵字格式錯誤

- [ ] 關鍵字欄位只輸入空格或逗號
- [ ] 離開欄位
- [ ] 確認關鍵字陣列為空

---

### ✅ 測試 20：跨瀏覽器測試

在不同瀏覽器中重複測試 1-19：

- [ ] Chrome
- [ ] Edge
- [ ] Firefox
- [ ] Safari（Mac）

---

## 🐛 已知問題與限制

### 1. Excel 檔案大小

- **限制**：超大 Excel（>5 MB）可能導致瀏覽器卡頓
- **解決**：分批匯入或優化資料

### 2. PDF 提取準確度

- **限制**：AI 提取可能有誤
- **解決**：人工確認並修正

### 3. 並發編輯

- **限制**：多人同時編輯可能衝突
- **解決**：協調編輯時間或實作鎖定機制

### 4. 瀏覽器快取

- **問題**：修改後可能看到舊資料
- **解決**：強制重新整理（Ctrl+Shift+R）

---

## 📊 測試報告範本

```markdown
# 測試報告

**測試日期**：2026-01-20
**測試人員**：[姓名]
**環境**：[作業系統] + [瀏覽器]

## 測試結果

| 測試項目           | 狀態    | 備註       |
| ------------------ | ------- | ---------- |
| 基本訪問           | ✅ PASS | -          |
| 管理後台登入       | ✅ PASS | -          |
| 載入現有知識庫     | ✅ PASS | 共 15 筆   |
| 下載 Excel 範本    | ✅ PASS | -          |
| Excel 匯入（拖放） | ✅ PASS | 匯入 3 筆  |
| Excel 匯入（選擇） | ✅ PASS | -          |
| CSV 匯入           | ✅ PASS | -          |
| PDF 匯入           | ⏭️ SKIP | 無 API Key |
| 手動新增條目       | ✅ PASS | -          |
| 編輯現有條目       | ✅ PASS | -          |
| 刪除條目           | ✅ PASS | -          |
| 清空全部           | ✅ PASS | -          |
| 儲存知識庫         | ✅ PASS | -          |
| 驗證儲存結果       | ✅ PASS | -          |
| 知識庫重新載入     | ✅ PASS | -          |
| 備份檔案驗證       | ✅ PASS | -          |
| manifest.json      | ✅ PASS | -          |
| 錯誤處理           | ✅ PASS | -          |

## 發現的問題

1. [問題描述]
   - 嚴重程度：[低/中/高]
   - 重現步驟：...
   - 預期結果：...
   - 實際結果：...

## 建議改進

1. [改進建議]

## 總評

[✅ PASS / ❌ FAIL / ⚠️ 部分通過]

整體評價：...
```

---

## 🎯 快速驗證（5 分鐘）

如果時間有限，至少測試以下核心功能：

1. ✅ 登入管理後台
2. ✅ 下載 Excel 範本
3. ✅ 匯入 Excel 檔案
4. ✅ 手動新增 1 筆條目
5. ✅ 儲存知識庫（需後端）
6. ✅ 返回主介面並重新載入

---

## 📞 測試遇到問題？

請參考：

- [客戶操作手冊](./ADMIN_USER_GUIDE.md) - 詳細說明
- [部署指南](./DEPLOYMENT_GUIDE.md) - 環境設定
- [故障排除](./ADMIN_USER_GUIDE.md#6-常見問題排除) - 常見問題

---

**測試清單版本**：1.0.0  
**最後更新**：2026-01-20
